# Introduction

Provenance for Ocean

# Motivation

## What is provenance?

``` 
Provenance is information about entities, activities, and people involved in producing a piece of data or thing, which can be used to form assessments about its quality, reliability or trustworthiness
```
[link](https://www.w3.org/TR/prov-overview/#Abstract)

Keen readers may wish to refer to a longer introduction [here](https://www.w3.org/TR/2013/NOTE-prov-primer-20130430/#intuitive-overview-of-prov). We will first explain the key concepts of Prov and their equivalents in Ocean.

Provenance can be modeled as a graph consisting of the following nodes, and connections between the nodes. The nodes in the graph are:
* Entities 
``` 
In PROV, physical, digital, conceptual, or other kinds of thing are called entities. Examples of such entities are a web page, a chart, and a spellchecker
```

* Agents
``` 
An agent takes a role in an activity such that the agent can be assigned some degree of responsibility for the activity taking place. An agent can be a person, a piece of software, an inanimate object, an organization, or other entities that may be ascribed responsibility. When an agent has some responsibility for an activity, PROV says the agent was associated with the activity, where several agents may be associated with an activity and vice-versa. 
```
* Activities
``` 
Activities are how entities come into existence and how their attributes change to become new entities, often making use of previously existing entities to achieve this. They are dynamic aspects of the world, such as actions, processes, etc. For example, if the second version of document D was generated by a translation from the first version of the document in another language, then this translation is an activity.
```

![relationships between nodes](https://www.w3.org/TR/2013/NOTE-prov-primer-20130430/images/key-concepts.png)

Some of the connections between the nodes are:

* Entity-Activity interactions 
  - Activities generate new Entities  (wasGeneratedBy)
  - Activities make use of entities.  (used)
  
* Agent-Activity interactions
  - Agents are associated with activities (wasAssociatedWith)
  
* Entity-Entity interactions
  - Entities can be derived from other entities. (wasDerivedFrom)
  
* An activity can be started or finished at a particular time.


The rest of this document describes the format to be used for Provenance metadata in Ocean protocol.

## Provenance basics: Entities and Interactions 

In the Ocean context

* Data Assets and Algorithms are entities. 
* Publishers, Consumers and Service Providers are agents.
* Publishing and invoking services are activities. 

In simple language, we could state that 

* "User Bob uploaded a dataset to Ocean", the prov version of it would be: "(Agent) Bob was associated with a publishing activity, which generated a (entity) data asset".
* "Bob ran a Consent service to filter a dataset", the prov version: "(Agent) Bob was associated with a filtering activity, which *used* an (entity) data asset and  generated a new (entity) data asset. The consent service (entity) was associate with (involved in) generating the asset".

# Use cases

Provenance information can be read from 3 perspectives:

* Agent centered : `what people or organizations were involved in generating or manipulating the data assets`
* Object centered : The origins of (portions of) a dataset from other datasets
* Process centered: Capturing the actions and steps taken to generate the data asset.

Example use cases:

* An model training algorithm (an entity in Prov) has been involved in generating several assets (e.g. trained models). Let's assume that a data scientist found a bug in the algorithm and fixed it. Provenance metadata can help us find the datasets generated by this algorithm, which need to be updated.
* The publisher of a data asset A1 (entity in prov) requires that all data assets that used A1, must pay licensing fees as a percentage of their selling price. Provenance metadata can help us find all the data assets that used data asset A1.

# OCN Prov w.r.t W3C Prov

Ocean assets must include a provenance section in the asset metadata. Since the Ocean asset metadata is in JSON format, the provenance section is also defined in JSON, specifically PROV-JSON, which is the JSON spec for Provenance. 
An Ocean provenance metadata should be compatible with W3C Prov, however, it may have additional constraints outlined below. Ocean may provide validation tools to check if the provenance spec is Ocean standards compliant.

## Ocean IDs

IDs for ocean entities must be compliant with W3C [decentralized](https://w3c-ccg.github.io/did-spec/#simple-examples) IDs (DIDs), in the form "did:ocn:abcdefg123456789"

## Ocean entities

Ocean adds the following additional types for entities, activities and agents. Details such as attribute names and values would be included as a separate (repo?)

* Entities:
  - ocn:dataset : An Ocean dataset asset 
  - ocn:service : Ocean service 

* Activities:

  - ocn:publish : The act of publishing a data asset
  - ocn:invoke_service : The act of invoking an Ocean service.
  
## Use case 1 : Publishing

When a user publishes an asset for the first time on Ocean, they must include the following provenance metadata.
Each section has an example that follows.

* The metadata must declare the following attributes:
  - Entity (dataset) that is published
  - Activity (publishing)
  - Agent (the person, organization or software) that created the dataset
  - agent involved in the publishing
  - entity generated by the publishing activity

Example section:
* Prefixes used
```
"prefix": {
    "xsd": "http://www.w3.org/2001/XMLSchema#",
    "prov": "http://www.w3.org/ns/prov#",
    "ocn": "http://www.oceanprotocol.com/prov",
  }

```
* The agent involved, could be a prov:Person, prov:Organisation or prov:SoftwareAgent

```
"agent": {
    "ocn_prov:ocn_abvfwi89sjek": {
      "prov:label": "Hospital data administrator",
      "prov:type": {
                "$": "prov:Person",
                "type": "prov:QUALIFIED_NAME"
      },
      "ocn:did": "did:ocn:longdidnameabcd1234"
    }
  }
```

* The activity (publish) 

```
  "activity": {
    "ocn_prov:ocn_asf29fj291lkd": {
      "prov:label": "Compile the dataset",
      "prov:endTime": "2018-02-02T14:07:13", 
      "prov:startTime": "2018-02-02T11:03:23", 
      "prov:type": "ocn:publish"
    }
  }
```
* The entity (dataset) that was published

Example:
```
"entity": {
    "ocn_prov:ocn_ui38ghoqidkwl": {
      "prov:value": {
        "$": "A dataset of parkinsons sensor readings",
        "type": "xsd:string"
      }
      "prov:type":"ocn:dataset"
    }
  }
```

* generation attribute (entity<>activity)
```
{
  "wasGeneratedBy": {
    "_:wGB4": {
      "prov:entity": "ocn_prov:ocn_ui38ghoqidkwl",
      "prov:activity": "ocn_prov:ocn_asf29fj291lkd"
    }
  }
```

* association attribute (agent<>activity)
```
"wasAssociatedWith": {
    "_:wAW4": {
      "prov:agent": "ocn_prov:ocn_abvfwi89sjek",
      "prov:activity": "ocn_prov:ocn_asf29fj291lkd"
    }
  }
```

## Usecase 2 : Importing

When a user imports a dataset, suggested provenance <TODO>

## Usecase 3: Generating a new asset

Ocean services such as data cleaning, model training and others, generate a new data asset. This process could have the following characteristics

- It could use one or more datasets or algorithms as input  (e.g a trained model would need an algorithm, and a traing set as input)
- It could generate one of more datasets or algorithms as output (e.g. a trained model, and predictions from the model, could be the output of the activity)


### Constraints

The provenance graph must specify the following nodes:

- Agents:
  - The agent (person) that invoked the service
  - The agent (software) running the service. (e.g. a data cleaning service is an agent, and a different agent (the user) invoked the service)

- Entities:
  - A list of (prov) entities used as inputs to this activity. It could contains a list of data assets and algorithms.
  - a list of (prov) entities that are generated by rthis activity. This could be referred to as "self" (but what if multiple entities are generated?)
  
- Activity: 

  - Running the service (e.g model training)
  
Example: 

* The agent involved. In this case, the hospital administrator and the data cleaning service
```
"agent": {
    "ocn_prov:ocn_abvfwi89sjek": {
      "prov:label": "Hospital data administrator",
      "prov:type": {
           "$": "prov:Person",
           "type": "prov:QUALIFIED_NAME"
      },
      "ocn:did": "did:ocn:llongameabcd2938"
    },
    "ocn_prov:ocn_abv2837282isk": {
      "prov:label": "data cleaning service",
      "prov:type": {
           "$": "prov:SoftwareAgent",
           "type": "prov:QUALIFIED_NAME"
      },
      "ocn:did": "did:ocn:anotherbigname3572"
    }
  }
```

* The activity (data cleaning) 

```
  "activity": {
    "ocn_prov:ocn_asf29fj291lkd": {
      "prov:label": "Cleaning the dataset",
      "prov:endTime": "2018-02-02T14:07:13", 
      "prov:startTime": "2018-02-02T11:03:23", 
      "prov:type": "ocn:service"
    }
  }
```
* The entity (dataset) that was generated

Example:
```
"entity": {
    "ocn_prov:ocn_ui38gsxh27dkeiq": {
      "prov:value": {
        "$": "A dataset of cleaned parkinsons sensor readings",
        "type": "xsd:string"
      }
      "prov:type":"ocn:dataset"
    }
  }
```

* generation attribute (The entity that was generated by the activity)
```
{
  "wasGeneratedBy": {
    "_:wGB4": {
      "prov:entity": "ocn_prov:ocn_ui38gsxh27dkeiq",
      "prov:activity": "ocn_prov:ocn_asf29fj291lkd"
    }
  }
```

* association attribute (the agents involved in the activity)
```
"wasAssociatedWith": {
    "_:wAW4": {
      "prov:agent": "ocn_prov:ocn_abvfwi89sjek",
      "prov:activity": "ocn_prov:ocn_asf29fj291lkd"
    },
    "_:wAW5": {
      "prov:agent": "ocn_prov:ocn_abv2837282isk",
      "prov:activity": "ocn_prov:ocn_asf29fj291lkd"
    }
  }
```

* usedby attribute()
```

```

* derivedby attribute
```
"wasDerivedFrom": {
    "_:wDF2": {
      "prov:generatedEntity": "ocn_prov:ocn_ui38gsxh27dkeiq",
      "prov:usedEntity": "ocn_prov:ocn_ui38ghoqidkwl"
    }
```


## FAQ

1. Provenance metadata should refer to the asset IDs. If the asset ID is unavailable (since it is generated on creation of the metadata), the provenance cannot refer to the assets generated.
  - The resulting asset will have a id with the value 'this'. It refers to the asset indicated by this id.

2. Multiple entities/assets can be generated while generating a new asset. If "implicit"/self asset ids are assumed, then we cannot pinpoint the asset referenced. 
 - Each asset should have its own asset metadata, multiple assets should not share the same metadata.
 
3. Do activities need an ID?
 - Activities will benefit by having an ID. If an asset/service provider chooses to expose a log of activities, users can verify the activity details. However, it is not mandatory for activities to have an ID.
 
4. Who generates the provenance metadata?
 - When a service generates an asset, the service has 2 options: 
 - It can return the result and not register it as an asset.
 - It can register the result as an asset and return the asset id.
 
 
