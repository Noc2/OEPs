```
shortname: 6/CSAPI
name: API to register & invoke computer services   
type: Standard
status: Raw
editor: Mike Anderson <mike.anderson@dex.sg>
contributors: 
```

<!--ts-->

Table of Contents
=================

   * [Table of Contents](#table-of-contents)
   * [Service Invocation](#service-invocation)
      * [Change Process](#change-process)
      * [Language](#language)
      * [Motivation](#motivation)
      * [Specification](#specification)
         * [Proposed Solution](#proposed-solution)
         * [Registering a Service](#registering-a-service)
         * [Retrieve metadata of an Service](#retrieve-metadata-of-a-service)
         * [Updating Service Metadata](#updating-service-metadata)
         * [Retiring a Service](#retiring-a-service)
         * [Invoking a Service](#invoking-a-service)
         * [Providing Service proof](#proving-a-service)
         * [Consuming Service results](#consuming-service-results)
         * [Targeted Release](#targeted-release)
      * [Copyright Waiver](#copyright-waiver)

      
<!--te-->

<a name="service-invocation"></a>
# Service Invocation

The Service Invocation API (**INVOKE**) is a specification for the Ocean Protocol to register and invoke compute jobs.

INVOKE offers a general purpose computational interface

Compute services are defined as services available on the Ocean Network that

* Can be invoked by any Ocean Agent connected to the Ocean Network (subject to access restrictions)
* May accept one or more Input parameters (which will typically be data assets to be used or algorithms to be run)
* Typically produce one or more Outputs (which will typically be references to generated data assets)
* Support the provision of proofs by service providers upon service completion (after which tokens in escrow may be released) 

This OEP does not prescribe the exact type of compute services offered. It is open to service provider implementations to define there, providing that they conform with this API specification
This OEP does not cover service discovery.
The OEP is not intended to apply to services where invocation / access is off-chain (e.g. high volume APIs or queue services)

This specification is based on [Ocean Protocol technical whitepaper](https://github.com/oceanprotocol/whitepaper), [3/ARCH](../3/README.md), [4/KEEPER](../4/README.md) and [5/AGENT](../5/README.md).


<a name="change-process"></a>
## Change Process
This document is governed by the [2/COSS](../2/README.md) (COSS).

<a name="language"></a>
## Language
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in [BCP 14](https://tools.ietf.org/html/bcp14) \[[RFC2119](https://tools.ietf.org/html/rfc2119)\] \[[RFC8174](https://tools.ietf.org/html/rfc8174)\] when, and only when, they appear in all capitals, as shown here.

<a name="motivation"></a>
## Motivation

Ocean network aims to power marketplaces for relevant AI-related data services.
There is a need for a standardised **interface** for the invocation of compute services so that different implementations can be provided and invoked by users of the Ocean Protocol.

Requirements are:

* ASSETS are DATA objects describing RESOURCES under control of a PUBLISHER
* SERVICES are compute services according to the protocol defined in this OEP
* PROVIDERS register and offer SERVICES 
* PROVIDERS may publish SERVICE METADATA relating to the service offered
* CONSUMER can identify services with a unique ID on the Ocean Network 
* CONSUMER can invoke services via an OCEAN AGENT (subject to contract and access requirements) 
* SERICES may require INPUTS 
* SERICES may produce OUTPUTS
* INPUT ASSETS must be available for the service provider to consume
* SERVICE CONTRACT must be settled and any tokens transfered after receipt of valid PROOF
  
<a name="specification"></a>

### Application Abstraction

From a temporal perspective, the invoke API has the following types of requirements:

- Registration
  - Register the service on Ocean with metadata that declares its service capabilities.
  - Make service artifacts available (e.g. register a Docker instance of Docker hub)
  
- Deployment 
  - Deploy the package from a trusted source (e.g. install from DockerHub)
  
- Invocation
  The API needs to provide the ability to:
  - start the job providing Ocean (or other) inputs, including configuration
  - Query the status of the job
  - Stop the job (while in progress)
  
- Post invocation
  - Enable collection of results/generated outputs
  - Enable registration of generated assets on Ocean and inform the service consumer
  - Offer proof of compute job completion to verifiers
  
- Uninstallation
  - Uninstall the package.
  - Delete any data generated by the job.
 
## Constraints

The execution environment must support the following abstractions:

* The package must have the capability to be installed in 
  - a local machine 
  - on a publisher's cloud 
  - on a third party cloud service
* The install package must not depend on the host container for managing its dependencies. (e.g. Docker installs all the dependencies, including the correct language version and its dependencies)
* The package must be language agnostic (i.e it should not mandate that the invoke job implementation must use a particular language or language version).
* Report failures with sufficient information

### Service Options

* The service may be offered free or for a price
* The service may offer proof of completion

* 

## Options for a host platform

| Host platform | Install package | Dependencies managed            | Scaling across machines | Can be installed locally? | Language agnostic?   |
|---------------|-----------------|---------------------------------|-------------------------|---------------------------|----------------------|
| JVM           | jar             | no                              | no                      | yes                       | (only JVM supported) |
| Python        | pip             | yes (partial-needs more inputs) | no                      | yes                       | no                   |
| Docker        | docker          | yes                             | no                      | yes                       | yes                  |
| Kubernetes    | Helm chart      | yes                             | yes                     | yes                       | yes                  |
| Spark         | jar             | yes                             | yes                     | yes                       | partial              |
|               |                 |                                 |                         |                           |                      |

## Suggested choice

The suggested choice for the initial host platform is Kubernetes, for the following reasons.


* Open standard (CNCF), 36 companies [support it](https://techcrunch.com/2017/11/13/the-cncf-just-got-36-companies-to-agree-to-a-kubernetes-certification-standard/)
* Can be installed on local or cloud hosts
* Unlike Docker, multi-node orchestration is possible.
* Excellent tooling support, both CLI and REST APIs available.
* Package distribution (Helm charts) has an active ecosystem


## Specification 

The **Service Metadata** information should be managed using an API on the Ocean Agent. 
As general rule, only the INDISPENSABLE information to run the Smart Contracts MUST be stored in the Decentralised VM

This API should exposes the following capabilities in the Ocean Agent:

* Registering a new Service
* Retrieve metadata information of an Service
* Update the metadata of an existing Service 
* Retire a Service

The following restrictions apply during the design/implementation of this OEP:

* The SERVICES registered in the system MUST be associated to the PROVIDER registering the services
* Basic information about the SERVICES (ids, pricing, reference to service endpoints) MUST be stored in the Decentralised VM  
* AGENT MUST NOT store or rely on any other information about the Services during this process

### Proposed Solution

